---
title: 快速开始
description: 通过 USB/BLE 集成 OneKey 硬件钱包的完整指南
---

# 快速开始

本指南涵盖集成 OneKey 硬件钱包的完整流程：安装 SDK、初始化、发现设备、处理 UI 提示，以及发起首次签名调用。

## 传输概览

USB 场景一律推荐 `@onekeyfe/hd-common-connect-sdk`。`@onekeyfe/hd-web-sdk` 仅用于插件端（iframe 宿主）等历史场景。

### 连接方式

| 方式 | 描述 | 支持机型 |
|--------|-------------|-------------------|
| **USB / WebUSB** | 有线 USB；Web 使用 WebUSB，原生使用底层插件 | 所有 OneKey 设备 |
| **Bluetooth BLE（原生）** | 原生 App 的 BLE；不支持 Web Bluetooth | Pro、Touch、Classic 1s / Classic 1s Pure；**Mini 不支持 BLE** |
| **Air-Gap（二维码）** | 离线扫码签名 | 仅 OneKey Pro |

### 传输决策表（与首页一致）

| 平台 | 传输 | SDK 包 | 指南 |
|----------|----------------------|---------|---------|
| Web（浏览器） | WebUSB | `@onekeyfe/hd-common-connect-sdk` | [WebUSB 连接指南](/zh/hardware-sdk/transport/web-usb) |
| React Native | BLE | `@onekeyfe/hd-ble-sdk` | [React Native BLE](/zh/hardware-sdk/transport/react-native-ble) |
| Android（原生） | BLE | `@onekeyfe/hd-common-connect-sdk` | [Android BLE](/zh/hardware-sdk/transport/android) |
| iOS（原生） | BLE | `@onekeyfe/hd-common-connect-sdk` | [iOS BLE](/zh/hardware-sdk/transport/ios) |
| Flutter | BLE | `@onekeyfe/hd-common-connect-sdk` | [Flutter BLE](/zh/hardware-sdk/transport/flutter) |

![传输架构](/images/transport/transport-architecture-zh.svg)

低层协议与自定义通道参考：[底层传输插件与协议](/zh/hardware-sdk/concepts/low-level-plugin)

## 安装 SDK

按运行时选择一个入口安装：

按需安装（选一）：

```bash
# Web / 桌面 WebUSB（推荐）
npm i @onekeyfe/hd-common-connect-sdk

# React Native BLE
npm i @onekeyfe/hd-ble-sdk

# 原生宿主 + 底层插件（Android/iOS/Flutter 桥接）
npm i @onekeyfe/hd-common-connect-sdk

# 插件端 iframe（仅历史场景）
npm i @onekeyfe/hd-web-sdk
```

传输细节：
- WebUSB：[WebUSB 指南](/zh/hardware-sdk/transport/web-usb)
- React Native BLE：[BLE 指南](/zh/hardware-sdk/transport/react-native-ble)
- 原生 Android / iOS / Flutter：通过底层传输插件桥接 JS，见各平台页面。

## 初始化 SDK

按照运行时选择对应的初始化方式，避免混用。

### Web / 桌面 WebUSB（`@onekeyfe/hd-common-connect-sdk`）

```ts
import HardwareSDK from '@onekeyfe/hd-common-connect-sdk';

await HardwareSDK.init({
  env: 'webusb',
  debug: process.env.NODE_ENV !== 'production',
  fetchConfig: true,
});
```

### React Native BLE（`@onekeyfe/hd-ble-sdk`）

```ts
import HardwareSDK from '@onekeyfe/hd-ble-sdk';

await HardwareSDK.init({
  debug: __DEV__,
});
```

### 原生桥接 / 自定义低层（`@onekeyfe/hd-common-connect-sdk`）

```ts
import HardwareSDK from '@onekeyfe/hd-common-connect-sdk';

await HardwareSDK.init({
  env: 'lowlevel',  // 'webusb' | 'lowlevel' | 'react-native' | 'emulator'
  debug: process.env.NODE_ENV !== 'production',
  fetchConfig: true,
});
```

| 环境 | 使用场景 |
|------|----------|
| `webusb` | 浏览器 WebUSB（无 iframe） |
| `lowlevel` | 原生应用通过底层适配器桥接 JS |
| `react-native` | 基于自定义 RN 桥或 Electron BLE |
| `emulator` | 使用内置模拟器 |

### 插件端 iframe（仅当宿主要求 `@onekeyfe/hd-web-sdk`）

```ts
import { HardwareSDK } from '@onekeyfe/hd-web-sdk';

await HardwareSDK.init({
  debug: process.env.NODE_ENV !== 'production',
  connectSrc: 'https://jssdk.onekey.so/1.1.19', // iframe host
});
```

## 绑定事件

设置设备连接和 UI 提示的事件监听器：

```ts
import { UI_EVENT, UI_REQUEST, DEVICE } from '@onekeyfe/hd-core';

HardwareSDK.on(UI_EVENT, async (message) => {
  switch (message.type) {
    case UI_REQUEST.REQUEST_PIN:
      // 处理 PIN 输入（见下文）
      break;
    case UI_REQUEST.REQUEST_PASSPHRASE:
      // 处理密码短语输入（见下文）
      break;
  }
});

HardwareSDK.on(DEVICE.CONNECT, (payload) => console.log('已连接:', payload));
HardwareSDK.on(DEVICE.DISCONNECT, (payload) => console.log('已断开:', payload));
```

## 发现设备

### WebUSB 授权（浏览器）

```ts
import { ONEKEY_WEBUSB_FILTER } from '@onekeyfe/hd-shared';

// 触发浏览器设备选择器
await navigator.usb.requestDevice({ filters: ONEKEY_WEBUSB_FILTER });
```

### 搜索设备

```ts
const result = await HardwareSDK.searchDevices();
if (!result.success) throw new Error(result.payload.error);

const devices = result.payload;
// [{ connectId, deviceId?, name, deviceType, ... }]
```

### 获取设备特征

从 `connectId` 解析 `device_id`（BLE 连接必需）：

```ts
const features = await HardwareSDK.getFeatures(connectId);
if (!features.success) throw new Error(features.payload.error);

const deviceId = features.payload.device_id;
```

> **重要：** 保存 `connectId` 和 `device_id` 用于后续 API 调用。

## 处理 PIN 输入

当执行受保护的调用且设备已锁定时，处理 `REQUEST_PIN`：

```ts
import { UI_RESPONSE } from '@onekeyfe/hd-core';

// 方式 1：在设备上输入（推荐）
await HardwareSDK.uiResponse({
  type: UI_RESPONSE.RECEIVE_PIN,
  payload: '@@ONEKEY_INPUT_PIN_IN_DEVICE'
});

// 方式 2：软件盲输 PIN（Pro/Touch 不支持）
await HardwareSDK.uiResponse({
  type: UI_RESPONSE.RECEIVE_PIN,
  payload: userInputPin  // 例如 '1234'
});
```

> **注意：** OneKey Pro 和 Touch 设备仅支持设备端 PIN 输入。

## 处理密码短语

访问隐藏钱包时，处理 `REQUEST_PASSPHRASE`：

```ts
// 方式 1：在设备上输入（最安全）
await HardwareSDK.uiResponse({
  type: UI_RESPONSE.RECEIVE_PASSPHRASE,
  payload: { passphraseOnDevice: true, value: '' }
});

// 方式 2：软件输入，可选会话缓存
await HardwareSDK.uiResponse({
  type: UI_RESPONSE.RECEIVE_PASSPHRASE,
  payload: { value: userPassphrase, passphraseOnDevice: false, save: true }
});
```

强制使用标准钱包（跳过密码短语），在任意方法调用中添加 `useEmptyPassphrase: true`。

## 首次签名调用

示例：签名 EVM 消息（EIP-191 personal_sign）：

```ts
const message = 'Hello OneKey';
const messageHex = Buffer.from(message).toString('hex');

const res = await HardwareSDK.evmSignMessage(connectId, deviceId, {
  path: "m/44'/60'/0'",
  messageHex,
  chainId: 1,
});

if (!res.success) throw new Error(res.payload.error);

console.log('地址:', res.payload.address);
console.log('签名:', res.payload.signature);
```

## 下一步

- **传输设置：** [WebUSB](/zh/hardware-sdk/transport/web-usb) | [React Native BLE](/zh/hardware-sdk/transport/react-native-ble) | [原生 BLE](/zh/hardware-sdk/transport/android)
- **链 API：** 使用侧边栏的链选择器查找特定签名方法
- **参考：** [通用参数](/zh/hardware-sdk/core-api-guide#common-params) | [错误码](/zh/hardware-sdk/api-reference#error-codes)
