---
title: BTC Signer
---

# BTC Signer

æ¯”ç‰¹å¸ UTXO ç¡¬ä»¶ç­¾åå…¨é“¾è·¯æŒ‡å—ï¼ˆOneKey ç‰ˆï¼‰ï¼Œè¦†ç›–åœ°å€ç¡®è®¤ã€P2PKH / P2SH-P2WPKH / P2WPKH / Taproot äº¤æ˜“ç­¾åï¼Œå¼ºè°ƒâ€œè·¯å¾„ä¸è„šæœ¬åŒ¹é…ã€refTxs å®Œæ•´ã€è®¾å¤‡å¯éªŒè¯â€ã€‚  
Bitcoin UTXO signing guide (OneKey), covers address verification and P2PKH / P2SH-P2WPKH / P2WPKH / Taproot signing with path-script matching and full refTxs.

## ğŸ”¹ Index / ç›®å½•

1. [How it works / å·¥ä½œåŸç†](#-how-it-works--å·¥ä½œåŸç†)
2. [Installation / å®‰è£…](#-installation--å®‰è£…)
3. [Initialisation / åˆå§‹åŒ–](#-initialisation--åˆå§‹åŒ–)
4. [Use Cases / ç”¨ä¾‹](#-use-cases--ç”¨ä¾‹)
   - [Get Address](#use-case-1-get-address)
   - [Sign Transaction](#use-case-2-sign-transaction)
5. [äº¤äº’ä¸çŠ¶æ€](#-äº¤äº’ä¸çŠ¶æ€)
6. [Examples / ç¤ºä¾‹](#-examples--ç¤ºä¾‹)
7. [Validation & Troubleshooting / éªŒç­¾ä¸æ’éšœ](#-validation--troubleshooting--éªŒç­¾ä¸æ’éšœ)

## ğŸ”¹ How it works / å·¥ä½œåŸç†

OneKey BTC signer talks to the device app via `HardwareSDK`, wraps APDUs into UTXO review and signing tasks. Key points / æ ¸å¿ƒè¦ç‚¹ï¼š

- Path must match script purpose (44/49/84/86) / è·¯å¾„å¿…é¡»ä¸è„šæœ¬ purpose å¯¹åº”ã€‚
- Each input requires full previous tx (`refTxs`) / æ¯ä¸ªè¾“å…¥éƒ½éœ€è¦å®Œæ•´å‰åºäº¤æ˜“ã€‚
- Device shows inputs/outputs/change/fee, confirms then returns signatures or serialized tx / è®¾å¤‡é€æ¡å±•ç¤ºè¾“å…¥/è¾“å‡º/æ‰¾é›¶/æ‰‹ç»­è´¹åè¿”å›ç­¾åã€‚

## ğŸ”¹ Installation / å®‰è£…

```bash
npm i @onekeyfe/hd-core @onekeyfe/hd-common-connect-sdk
```

## ğŸ”¹ Initialisation / åˆå§‹åŒ–

```ts
import HardwareSDK from '@onekeyfe/hd-common-connect-sdk';
await HardwareSDK.init({ env: 'webusb', fetchConfig: true, debug: false });
const [{ connectId }] = await HardwareSDK.searchDevices();
const deviceId = (await HardwareSDK.getFeatures(connectId)).payload?.device_id;
```

## ğŸ”¹ Use Cases / ç”¨ä¾‹

### Use Case 1: Get Address

```ts
const path84 = "m/84'/0'/0'/0/0";
const res = await HardwareSDK.btcGetAddress(connectId, deviceId, {
  path: path84,
  coin: 'btc',
  showOnOneKey: true,
});
// res.payload.address, publicKey?, path
```

**Parameters / å‚æ•°**

- `path` / `address_n`: å¿…å¡«ï¼ŒBIP44 è·¯å¾„æˆ–æ•°ç»„ï¼›éœ€ä¸è„šæœ¬ purpose å¯¹åº”ã€‚
- `coin`: å¿…å¡«ï¼Œç½‘ç»œæ ‡è¯†ï¼ˆå¦‚ `btc` / `test`ï¼‰ã€‚
- `showOnOneKey?`: å¯é€‰ï¼Œæ˜¯å¦åœ¨è®¾å¤‡ä¸Šå±•ç¤ºå¹¶ç¡®è®¤ã€‚

**Returns / è¿”å›**

`Promise<{ success, payload: { address, path, publicKey?, chainCode? } }>`

---

### Use Case 2: Sign Transaction

```ts
const { success, payload } = await HardwareSDK.btcSignTransaction(connectId, deviceId, {
  coin: 'btc',
  inputs,
  outputs,
  refTxs,
  locktime: 0,
});
// payload.serializedTx
```

**Parameters / å‚æ•°**

- `coin`: å¿…å¡«ï¼Œå†³å®šç½‘ç»œè§„åˆ™ä¸å‰ç¼€ã€‚
- `inputs`: å¿…å¡«ï¼Œæ•°ç»„ï¼Œå­—æ®µåŒ…å«ï¼š
  - `address_n`ï¼ˆè·¯å¾„ï¼Œä¸è„šæœ¬åŒ¹é…ï¼‰
  - `prev_hash`ï¼ˆUTXO txidï¼Œhexï¼‰
  - `prev_index`ï¼ˆUTXO voutï¼‰
  - `amount`ï¼ˆå­—ç¬¦ä¸² satoshiï¼‰
  - `script_type`ï¼ˆ`SPENDADDRESS` / `SPENDP2SHWITNESS` / `SPENDWITNESS` / `SPENDTAPROOT`ï¼‰
- `outputs`: å¿…å¡«ï¼Œæ•°ç»„ï¼Œå­—æ®µåŒ…å«ï¼š
  - æ”¶æ¬¾åœ°å€è¾“å‡ºï¼š`address` + `amount` + `script_type`ï¼ˆå¦‚ `PAYTOADDRESS`ï¼‰
  - æ‰¾é›¶è¾“å‡ºï¼š`address_n` + `amount` + `script_type` å¯¹åº”è„šæœ¬
- `refTxs`: å¿…å¡«ï¼Œè¦†ç›–æ‰€æœ‰è¾“å…¥çš„å®Œæ•´å‰åºäº¤æ˜“
- `locktime?`: å¯é€‰ï¼Œæ•°å­—

**Returns / è¿”å›**

`Promise<{ success, payload: { serializedTx, signatures?: any } }>`

## ğŸ”¹ äº¤äº’ä¸çŠ¶æ€

- æ¥å£ä»¥ Promise ç»“æŸï¼›ç”¨æˆ·æç¤ºé€šè¿‡ `UI_REQUEST` äº‹ä»¶è§¦å‘ï¼ˆè§£é”è®¾å¤‡ã€æ‰“å¼€ BTC Appã€ç¡®è®¤è¾“å…¥/è¾“å‡º/æ‰¾é›¶/æ‰‹ç»­è´¹ï¼‰ã€‚
- åŒä¸€è®¾å¤‡è¯·ä¸²è¡Œè°ƒç”¨ï¼›ç­¾åå‰ç”¨ `showOnOneKey` ç¡®è®¤æ”¶æ¬¾/æ‰¾é›¶è·¯å¾„ã€‚

## ğŸ”¹ Examples / ç¤ºä¾‹

### Example: P2SH-P2WPKH Transaction / åµŒå¥— SegWit äº¤æ˜“

```ts
import HardwareSDK from '@onekeyfe/hd-common-connect-sdk';

await HardwareSDK.init({ env: 'webusb', debug: false });

const [{ connectId }] = await HardwareSDK.searchDevices();
const deviceId = (await HardwareSDK.getFeatures(connectId)).payload?.device_id;

const path49 = [(49 | 0x80000000) >>> 0, (0 | 0x80000000) >>> 0, (0 | 0x80000000) >>> 0, 0, 0];
await HardwareSDK.btcGetAddress(connectId, deviceId, { path: path49, coin: 'btc', showOnOneKey: true });

const inputs = [
  {
    address_n: path49,
    prev_index: 0,
    prev_hash: 'b035d89d4543ce5713c553d69431698116a822c57c03ddacf3f04b763d1999ac',
    amount: '3382047',
    script_type: 'SPENDP2SHWITNESS',
  },
];

const outputs = [
  {
    address_n: [(49 | 0x80000000) >>> 0, (0 | 0x80000000) >>> 0, (0 | 0x80000000) >>> 0, 1, 1],
    amount: '3181747',
    script_type: 'PAYTOP2SHWITNESS', // æ‰¾é›¶
  },
  {
    address: '18WL2iZKmpDYWk1oFavJapdLALxwSjcSk2',
    amount: '200000',
    script_type: 'PAYTOADDRESS', // æ”¶æ¬¾äºº
  },
];

const refTxs = [
  {
    hash: 'b035d89d4543ce5713c553d69431698116a822c57c03ddacf3f04b763d1999ac',
    version: 1,
    lock_time: 0,
    inputs: [/* å‰åºäº¤æ˜“çš„ inputs */],
    bin_outputs: [/* å‰åºäº¤æ˜“çš„ outputs */],
  },
];

const { success, payload } = await HardwareSDK.btcSignTransaction(connectId, deviceId, {
  coin: 'btc',
  inputs,
  outputs,
  refTxs,
  locktime: 0,
});

if (success) {
  console.info('signed tx:', payload.serializedTx); // å¯ç›´æ¥å¹¿æ’­
}
```

## ğŸ”¹ Validation & Troubleshooting / éªŒç­¾ä¸æ’éšœ

- è·¯å¾„ â†” è„šæœ¬ï¼š
  - `44'` â†’ P2PKH
  - `49'` â†’ P2SH-P2WPKH
  - `84'` â†’ P2WPKH
  - `86'` â†’ P2TR
- å¿…é¡»æä¾›å®Œæ•´ `refTxs`ï¼šç¼ºå¤±ä»»ä½•è¾“å…¥çš„å‰åºäº¤æ˜“ä¼šè¢«æ‹’ç­¾ã€‚
- æ‰¾é›¶ï¼šç¡®ä¿ `address_n` å±äºåŒä¸€è´¦æˆ·è·¯å¾„ï¼Œé˜²æ­¢ç”¨æˆ·æ··æ·†ã€‚
- è®¾å¤‡ç¡®è®¤ï¼šè¾“å…¥ã€è¾“å‡ºã€æ‰¾é›¶ã€æ‰‹ç»­è´¹éœ€ä¸å‰ç«¯æ˜¾ç¤ºä¸€è‡´ã€‚
- éªŒç­¾ï¼šç”¨ `bitcoinjs-lib` / `@scure/btc-signer` é‡å»ºäº¤æ˜“ï¼Œæ ¡éªŒ txid ä¸ `serializedTx`ã€‚
- å¸¸è§é—®é¢˜ï¼š
  - è¾“å…¥è¿‡å¤šï¼šåˆ†æ‰¹ç­¾åæˆ–ç²¾ç®€äº¤æ˜“ã€‚
  - æ‰‹ç»­è´¹å¼‚å¸¸ï¼šè°ƒæ•´è¾“å‡º/æ‰¾é›¶å¹¶éµå®ˆ dust è§„åˆ™ã€‚
  - æ‹’ç­¾/è¶…æ—¶ï¼šæä¾›é‡è¯•/å–æ¶ˆï¼Œä¸è¦è‡ªåŠ¨é‡æ’­ã€‚

å‚è§æ–¹æ³•æ–‡æ¡£ï¼š[btcSignTransaction](/zh/hardware-sdk/chains/bitcoin-and-bitcoin-forks/btcsigntransaction) Â· [btcGetAddress](/zh/hardware-sdk/chains/bitcoin-and-bitcoin-forks/btcgetaddress)ã€‚
