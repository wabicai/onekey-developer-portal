---
title: Solana Signer
---

# Solana Signer

全链路指南：概览 → 原理 → 安装/初始化 → 用例索引 → 参数/限制 → 设备显示与验签 → 交互 → 示例。

## 概览

- 支持：`solGetAddress`、`solSignTransaction`（对序列化消息/交易签名）。
- 路径固定且全硬化、长度 4：`m/44'/501'/account'/0'`（如 `m/44'/501'/0'/0'`）。
- 需自行序列化消息/交易为 `rawTx`（base64/hex）。

## 工作原理

- `HardwareSDK` 调用 signer，设备展示源/目的账户、金额、费用，确认后返回签名。
- 主机用 `@solana/web3.js` 解析 `rawTx`，附加签名并验证与 `solGetAddress` 返回公钥一致。

## 安装与初始化

```bash
npm i @onekeyfe/hd-common-connect-sdk @onekeyfe/hd-core @onekeyfe/hd-shared
```

```ts
import HardwareSDK from '@onekeyfe/hd-common-connect-sdk';
await HardwareSDK.init({ env: 'webusb', fetchConfig: true, debug: false });
const [{ connectId }] = await HardwareSDK.searchDevices();
const deviceId = (await HardwareSDK.getFeatures(connectId)).payload?.device_id;
```

## 用例索引

- 获取地址：`solGetAddress`
- 签名交易/消息：`solSignTransaction`

## 参数与限制

| 字段 | 说明 |
| --- | --- |
| `path` | 全硬化、长度 4（`44'/501'/account'/0'`） |
| `rawTx` | 序列化消息/交易，base64 或 hex |
| `keepSession?` | 可选，多次签名时复用会话 |

- 限制：超大消息或不支持的指令可能被拒；recent blockhash 需保持最新。

## 设备显示与主机验证

- 设备：路径/账户、目标账户、金额、费用概览；blockhash 隐含。
- 主机：用 `@solana/web3.js` 解析 `rawTx`，附加签名，验证与 `solGetAddress` 公钥一致。

## 交互与状态

- 订阅 `UI_EVENT`，等待 PIN/密码短语/确认提示。
- 状态流：未开始 → 进行中（等待确认）→ 成功/取消/错误；进行中应允许取消/重试。
- 并发：同一设备串行调用。

## 示例

```ts
import HardwareSDK from '@onekeyfe/hd-common-connect-sdk';

await HardwareSDK.init({ env: 'webusb', debug: false });

const [{ connectId }] = await HardwareSDK.searchDevices();
const deviceId = (await HardwareSDK.getFeatures(connectId)).payload?.device_id;

const path = "m/44'/501'/0'/0'";
await HardwareSDK.solGetAddress(connectId, deviceId, { path, showOnOneKey: true });

const rawTx =
  '4301355cc18d85809872bcbd63cb6ea5ac3c2814a1bacf2e50d8ec62367211917b79ecd1f1a98fa0d793d7cb92ebd9a479dc6aba0ae8570253aa87c0da32db5ed2bd401f3bbee52c2bc55761fd8486fae2e28f46499282f4267b8b90fc8c1cc97bb659b6cc927f2ec1701ef2928ddb84759ba5c557f549db';

const { success, payload } = await HardwareSDK.solSignTransaction(connectId, deviceId, {
  path,
  rawTx,
  keepSession: true,
});

if (success) {
  console.info('signature:', payload.signature);
}
```

## 测试向量（形态示例）

- 转账：路径 `m/44'/501'/0'/0'`，`rawTx` 为简单转账（含 from/to、公链币金额、recent blockhash）。期望签名附加后可用 Sender 地址验证。
> 签名取决于设备密钥，用于字段/流程参考。

## 校验与排障

- 路径必须遵循 `44'/501'/account'/0'`；其他路径会被拒。
|- `rawTx` 需包含最新 blockhash、正确的账户列表和指令顺序，否则广播失败。
- 同一设备串行调用，多次签名可配合 `keepSession`。
- 拒签/超时：提供重试/取消，不要自动重播。

参见方法文档：[solSignTransaction](/zh/hardware-sdk/chains/solana/solsigntransaction)。
