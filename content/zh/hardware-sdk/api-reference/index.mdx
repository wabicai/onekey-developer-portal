---
title: API 参考
---

# API 参考

单页涵盖初始化、请求基础、通用参数、HD 路径、事件/UI 流、PIN/Passphrase 规则与错误码。

<a id="init"></a>

## 初始化

选择运行环境后初始化 SDK：

```ts
HardwareSDK.init({
  debug: false,
  fetchConfig: true,
  env: 'webusb' | 'react-native' | 'lowlevel',
});
```

- `webusb`：浏览器 USB（需 HTTPS）
- `react-native`：RN + 蓝牙
- `lowlevel`：自定义底层传输插件（64 字节帧）

<a id="request-basics"></a>

## 请求基础

通用调用流程：

```
初始化 → 搜索设备 → 选择 connectId → getFeatures 得到 deviceId
       → 监听 UI/DEVICE/FIRMWARE 事件 → 调用链方法
       → 设备确认 → 返回签名/数据
```

```ts
const [{ connectId }] = await HardwareSDK.searchDevices();
const { payload: features } = await HardwareSDK.getFeatures(connectId);
const deviceId = features?.device_id;

HardwareSDK.on(UI_REQUEST.REQUEST_PIN, () => {/* 提示 PIN */});
HardwareSDK.uiResponse({ type: UI_RESPONSE.RECEIVE_PIN, payload: '1234' });

await HardwareSDK.evmSignTransaction(connectId, deviceId, { path: \"m/44'/60'/0'/0/0\" });
```

<a id="common-params"></a>

### 通用参数 (CommonParams)

- `keepSession?: boolean` 复用会话/缓存。
- `retryCount?` / `pollIntervalTime?` / `timeout?` 调整轮询次数、间隔、单次超时。
- `passphraseState?: string` / `useEmptyPassphrase?: boolean` 控制隐藏/标准钱包。
- `initSession?: boolean` 调用前初始化会话并缓存 `passphraseState`。
- `deriveCardano?: boolean` 为当前会话预派生 Cardano。
- `detectBootloaderDevice?: boolean` 引导模式提前失败。
- `skipWebDevicePrompt?: boolean` 跳过浏览器设备选择器。

提示：`passphraseState + keepSession` 可减少重复输入；WebUSB 需 HTTPS + 用户手势。

<a id="hd-path"></a>

### HD 路径与账户选择

- `path: string | number[]` 遵循 BIP44；ed25519 链必须全硬化。
- 示例：EVM `m/44'/60'/0'/0/0`；BTC 账户 `m/49'/0'/0'`；BTC 地址 `m/49'/0'/0'/0/0`；Solana `m/44'/501'/0'/0'`。
- 数组示例：`[(44 | 0x80000000) >>> 0, (0 | 0x80000000) >>> 0, 0x80000000, 0, 0]`。

<a id="events-ui"></a>

### 事件与 UI 处理

- 事件分组：`UI_EVENT`、`DEVICE_EVENT`、`FIRMWARE_EVENT`。
- 订阅：
  - 高层：`HardwareSDK.on(UI_EVENT, cb)` → `{ event, type, payload }`
  - 直接：`HardwareSDK.on(UI_REQUEST.REQUEST_PIN, cb)` → payload
- 常用响应：
  - `UI_RESPONSE.RECEIVE_PIN`
  - `UI_RESPONSE.RECEIVE_PASSPHRASE`（`passphraseOnDevice`=true 强制设备输入）
  - `UI_RESPONSE.SELECT_DEVICE_IN_BOOTLOADER_FOR_WEB_DEVICE`

常见 UI 请求：`ui-request_pin`、`ui-invalid_pin`、`ui-request_passphrase`、`ui-request_passphrase_on_device`、`ui-request_select_device_in_bootloader_for_web_device`、权限提示、固件进度、设备模式提示等。

<a id="pin"></a>

### PIN 要点

- Pro/Touch 只能设备端输入；其他机型支持软件盲输但优先设备端。
- UI：单一弹窗，动作为“在设备上输入”（默认）与“在此输入（盲输）”；3x3 固定键盘，不回显真实数字。

```ts
const BLIND_KEYBOARD_MAP = ['7','8','9','4','5','6','1','2','3'];
HardwareSDK.uiResponse({
  type: UI_RESPONSE.RECEIVE_PIN,
  payload: BLIND_KEYBOARD_MAP[label - 1],
});
```

<a id="passphrase"></a>

### Passphrase 要点

- 标准钱包 = 种子 + 空密码短语；隐藏钱包 = 种子 + 非空密码短语（区分大小写）。
- 主动：需要标准钱包时传 `useEmptyPassphrase: true`。
- 被动：`UI_REQUEST.REQUEST_PASSPHRASE` 时弹出表单，提供设备输入或软件输入（可选保存）。

```ts
HardwareSDK.uiResponse({
  type: UI_RESPONSE.RECEIVE_PASSPHRASE,
  payload: { passphraseOnDevice: true, value: '' },
});
HardwareSDK.uiResponse({
  type: UI_RESPONSE.RECEIVE_PASSPHRASE,
  payload: { value, passphraseOnDevice: false, save: true },
});
```

- 用 `passphraseState + keepSession/initSession` 减少重复输入；不持久化、不记录密码短语。

### 快速检查清单

1. Init → search → 获取 `connectId` / `deviceId`  
2. 订阅 `UI/DEVICE/FIRMWARE`，准备 `uiResponse`  
3. 选择 HD 路径和链参数，附带 CommonParams 调用  
4. 提示用户在设备上确认，读取签名/结果

<a id="error-codes"></a>

## 错误码

用于分支处理与用户提示（来源：hardware-js-sdk）。

### 0. 未知错误
- **UnknownError (0)** 未知错误

### 1. 设备 (101–118)
- **DeviceFwException (101)** 固件版本不匹配
- **DeviceUnexpectedMode (102)** 设备模式异常
- **DeviceListNotInitialized (103)** 设备列表未初始化
- **SelectDevice (104)** 请选择已连接设备
- **DeviceNotFound (105)** 未找到设备
- **DeviceInitializeFailed (106)** 初始化失败
- **DeviceInterruptedFromOutside (107)** 外部中断
- **RequiredButInBootloaderMode (108)** 需引导模式
- **DeviceInterruptedFromUser (109)** 用户中断
- **DeviceCheckDeviceIdError (110)** 设备 ID 不一致
- **DeviceNotSupportPassphrase (111)** 不支持密码短语
- **DeviceCheckPassphraseStateError (112)** 密码短语状态错误
- **DeviceNotOpenedPassphrase (113)** 未开启密码短语
- **DeviceOpenedPassphrase (114)** 已开启密码短语
- **DeviceDetectInBootloaderMode (115)** 设备处于引导模式
- **NotAllowInBootloaderMode (116)** 引导模式下不允许
- **DeviceBusy (117)** 设备繁忙
- **DeviceCheckUnlockTypeError (118)** 解锁类型不匹配
- **NotInitialized (200)** 未初始化

### 2. IFrame (300–305)
- **IFrameNotInitialized (300)** 未初始化
- **IFrameAleradyInitialized (301)** 已初始化
- **IFrameLoadFail (302)** 加载失败
- **IframeTimeout (303)** 初始化超时
- **IframeBlocked (304)** IFrame 被阻止
- **IframeDistrust (305)** 主机不受信任

### 3. 方法/固件 (400–418)
- **CallMethodError (400)** 运行时错误
- **CallMethodNotResponse (404)** 无响应
- **CallMethodInvalidParameter (405)** 参数无效
- **FirmwareUpdateDownloadFailed (406)** 固件下载失败
- **CallMethodNeedUpgradeFirmware (407)** 需要升级固件
- **CallMethodDeprecated (408)** 方法已废弃
- **FirmwareUpdateLimitOneDevice (409)** 升级只允许一台设备
- **FirmwareUpdateManuallyEnterBoot (410)** 需手动进入引导模式
- **FirmwareUpdateAutoEnterBootFailure (411)** 自动进入引导失败
- **NewFirmwareUnRelease (412)** 新固件未发布
- **UseDesktopToUpdateFirmware (413)** 使用 OneKey Desktop 更新
- **NewFirmwareForceUpdate (414)** 强制更新
- **DeviceNotSupportMethod (415)** 设备不支持该方法
- **ForbiddenKeyPath (416)** 禁用的路径
- **RepeatUnlocking (417)** 重复解锁
- **DefectiveFirmware (418)** 固件缺陷，需立即更新

### 4. 网络 (500)
- **NetworkError (500)** 网络请求错误

### 5. 传输 (600–603)
- **TransportNotConfigured (600)** 未配置
- **TransportCallInProgress (601)** 传输调用进行中
- **TransportNotFound (602)** 未找到传输
- **TransportInvalidProtobuf (603)** Protobuf 无效

### 6. 蓝牙 (700–722)
- **BleScanError (700)** 扫描错误
- **BlePermissionError (701)** 蓝牙权限缺失
- **BleLocationError (702)** 定位权限错误
- **BleRequiredUUID (703)** UUID 必填
- **BleConnectedError (704)** 连接错误
- **BleDeviceNotBonded (705)** 未配对
- **BleServiceNotFound (706)** 未找到服务
- **BleCharacteristicNotFound (707)** 未找到特征
- **BleMonitorError (708)** 监听错误
- **BleCharacteristicNotifyError (709)** 通知错误
- **BleWriteCharacteristicError (710)** 写入错误
- **BleAlreadyConnected (711)** 已连接
- **BleLocationServicesDisabled (712)** 定位服务关闭
- **BleTimeoutError (713)** 超时
- **BleForceCleanRunPromise (714)** 强制清理
- **BleDeviceBondError (715)** 配对失败
- **BleCharacteristicNotifyChangeFailure (716)** 通知切换失败
- **BleTransportCallCanceled (717)** 传输调用取消
- **BleDeviceBondedCanceled (718)** 配对取消
- **BlePeerRemovedPairingInformation (719)** 对端移除配对信息
- **BleDeviceDisconnected (720)** 设备断开
- **BlePoweredOff (721)** 蓝牙关闭
- **BleUnsupported (722)** 不支持蓝牙

### 7. 运行时 / Bridge (800–821)
- **RuntimeError (800)** 运行时错误
- **PinInvalid (801)** PIN 无效
- **PinCancelled (802)** PIN 输入被取消
- **ActionCancelled (803)** 操作被取消
- **FirmwareError (804)** 固件安装失败
- **ResponseUnexpectTypeError (805)** 响应类型异常
- **BridgeNetworkError (806)** Bridge 网络错误
- **BridgeTimeoutError (807)** Bridge 超时
- **BridgeNotInstalled (808)** Bridge 未安装
- **PollingTimeout (809)** 确认连接超时
- **PollingStop (810)** 确认连接停止轮询
- **BlindSignDisabled (811)** 设备关闭盲签
- **UnexpectPassphrase (812)** 意外的密码短语
- **FileAlreadyExists (813)** 文件已存在
- **CheckDownloadFileError (814)** 校验下载文件错误
- **NotInSigningMode (815)** 未处于签名模式
- **DataOverload (816)** 数据过大
- **BridgeDeviceDisconnected (817)** 操作中设备断开
- **BTCPsbtTooManyUtxos (818)** BTC PSBT UTXO 过多
- **EmmcFileWriteFirmwareError (819)** EMMC 写固件错误
- **FirmwareVerificationFailed (820)** 固件校验失败
- **BridgeNeedsPermission (821)** Web Bridge 需要权限

### 8. Web 设备 (901–902)
- **WebDeviceNotFoundOrNeedsPermission (901)** Web USB/蓝牙未找到或需授权
- **WebDevicePromptAccessError (902)** Web USB/蓝牙权限弹窗错误
