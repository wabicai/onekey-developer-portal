---
title: wallet_getPermissions
description: 获取 dApp 当前权限
---

# wallet_getPermissions

返回 dApp 当前已授权的权限。此方法不会提示用户。

---

## 参数

无

---

## 返回值

`Array` 权限对象数组：

| 字段 | 类型 | 说明 |
|------|------|------|
| `parentCapability` | `string` | 权限名称 |
| `date` | `number` | 授权时间戳 |
| `caveats` | `array` | 权限限制 |

---

## 示例

```typescript
const permissions = await window.$onekey.ethereum.request({
  method: 'wallet_getPermissions'
})

console.log('当前权限:', permissions)

// 检查是否已连接
const isConnected = permissions.some(
  p => p.parentCapability === 'eth_accounts'
)
console.log('是否已连接:', isConnected)
```

### 权限检查工具

```typescript
async function checkPermissions() {
  const permissions = await window.$onekey.ethereum.request({
    method: 'wallet_getPermissions'
  })

  return {
    hasAccounts: permissions.some(p => p.parentCapability === 'eth_accounts'),
    permissions
  }
}

const { hasAccounts } = await checkPermissions()
if (!hasAccounts) {
  // 请求连接
  await window.$onekey.ethereum.request({
    method: 'eth_requestAccounts'
  })
}
```

---

## 错误码

| 错误码 | 消息 | 说明 |
|--------|------|------|
| -32603 | Internal error | Provider 错误 |

---

## 说明

- 如果没有授权任何权限，返回空数组
- 不会提示用户进行任何操作
- 适合在不触发弹窗的情况下检查连接状态
- 遵循 [EIP-2255](https://eips.ethereum.org/EIPS/eip-2255) 规范
