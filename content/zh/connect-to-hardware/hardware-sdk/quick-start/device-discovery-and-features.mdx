---
title: 设备发现
---

# 设备发现

发现设备并获取其标识符。大多数 API 调用需要同时提供 `connectId` 和 `device_id`。

## WebUSB 授权（仅限浏览器）

使用官方过滤器，使选择器仅显示 OneKey 设备。

```ts
import { ONEKEY_WEBUSB_FILTER } from '@onekeyfe/hd-shared';

export async function authorizeUsb() {
  // @ts-ignore WebUSB 是浏览器 API
  await navigator.usb.requestDevice({ filters: ONEKEY_WEBUSB_FILTER });
}
```

## 枚举设备

```ts
import HardwareSDK from '@onekeyfe/hd-common-connect-sdk';

export async function search() {
  const result = await HardwareSDK.searchDevices();
  if (!result.success) throw new Error(result.payload.error);
  return result.payload; // [{ connectId, deviceId?, name, deviceType, ... }]
}
```

- WebUSB 结果通常包含 `deviceId`。
- BLE 结果包含 `connectId` 和 `name`，然后需要调用 `getFeatures` 获取 `device_id`。

## 获取特征（解析 device_id）

```ts
export async function getDeviceId(connectId: string) {
  const features = await HardwareSDK.getFeatures(connectId);
  if (!features.success) throw new Error(features.payload.error);
  return features.payload.device_id;
}
```

保存 `connectId` 和 `device_id` 用于后续调用。
