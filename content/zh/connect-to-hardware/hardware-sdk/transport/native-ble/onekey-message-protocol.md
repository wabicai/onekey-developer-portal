# OneKey 消息协议

消息以 64 字节的数据包发送。

第一个数据包具有以下结构：

| 偏移 | 长度 | 类型          | 内容                                                                                               |
| ------ | ------ | ------------- | ------------------------------------------------------------------------------------------------------ |
| 0      | 3      | char\[3]      | '?##' 魔术常量                                                                                   |
| 3      | 2      | BE uint16\_t  | 数字 [消息类型](https://github.com/OneKeyHQ/firmware/blob/touch/common/protob/messages.proto) |
| 5      | 4      | BE uint32\_t  | 消息大小                                                                                           |
| 9      | 55     | uint8\_t\[55] | 以 Protocol Buffers 编码的消息的前 55 字节（如果较短则用零填充）                  |

后续数据包具有以下结构：

| 偏移 | 长度 | 类型          | 内容                                                                               |
| ------ | ------ | ------------- | -------------------------------------------------------------------------------------- |
| 0      | 1      | char\[1]      | '?' 魔术常量                                                                     |
| 1      | 63     | uint8\_t\[63] | 以 Protocol Buffers 编码的消息的后续字节（如果较短则用零填充） |
